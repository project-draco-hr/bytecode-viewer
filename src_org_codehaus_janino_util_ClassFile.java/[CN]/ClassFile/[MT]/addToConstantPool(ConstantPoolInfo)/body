{
  Short index=(Short)this.constantPoolMap.get(cpi);
  if (index != null)   return index.shortValue();
  int res=this.constantPool.size();
  if (res > 0xFFFF) {
    throw new JaninoRuntimeException("Constant pool has grown past JVM limit of 0xFFFF");
  }
  this.constantPool.add(cpi);
  if (cpi.isWide())   this.constantPool.add(null);
  this.constantPoolMap.put(cpi,new Short((short)res));
  return (short)res;
}
