{
  super("ClassNavigation");
  setTitle("Files");
  this.fcn=fcn;
  open.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final TreeNode root=(TreeNode)tree.getModel().getRoot();
      expandAll(tree,new TreePath(root),true);
    }
  }
);
  close.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final TreeNode root=(TreeNode)tree.getModel().getRoot();
      expandAll(tree,new TreePath(root),false);
      tree.expandPath(new TreePath(root));
    }
  }
);
  getContentPane().setLayout(new BorderLayout());
  getContentPane().add(new JScrollPane(tree),BorderLayout.CENTER);
  MouseAdapter ml=new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      TreePath path=tree.getPathForLocation(e.getX(),e.getY());
      if (path == null)       return;
      final StringBuffer nameBuffer=new StringBuffer();
      for (int i=2; i < path.getPathCount(); i++) {
        nameBuffer.append(path.getPathComponent(i));
        if (i < path.getPathCount() - 1) {
          nameBuffer.append("/");
        }
      }
      String name=nameBuffer.toString();
      if (name.endsWith(".class")) {
        final ClassNode cn=BytecodeViewer.getClassNode(name.substring(0,name.length() - ".class".length()));
        if (cn != null) {
          openClassFileToWorkSpace(nameBuffer.toString(),cn);
        }
      }
 else {
        openFileToWorkSpace(nameBuffer.toString(),BytecodeViewer.getFileContents(nameBuffer.toString()));
      }
    }
  }
;
  this.tree.addMouseListener(ml);
  this.tree.addTreeSelectionListener(new TreeSelectionListener(){
    @Override public void valueChanged(    final TreeSelectionEvent arg0){
      final TreePath path=arg0.getPath();
      if (((TreeNode)path.getLastPathComponent()).getChildCount() > 0)       return;
      final StringBuffer nameBuffer=new StringBuffer();
      for (int i=1; i < path.getPathCount(); i++) {
        nameBuffer.append(path.getPathComponent(i));
        if (i < path.getPathCount() - 1) {
          nameBuffer.append("/");
        }
      }
      String name=nameBuffer.toString();
      if (name.endsWith(".class")) {
        final ClassNode cn=BytecodeViewer.getClassNode(name.substring(0,name.length() - ".class".length()));
        if (cn != null) {
          openClassFileToWorkSpace(nameBuffer.toString(),cn);
        }
      }
 else {
        openFileToWorkSpace(nameBuffer.toString(),BytecodeViewer.getFileContents(nameBuffer.toString()));
      }
    }
  }
);
  final String quickSearchText="Quick class search (no file extension)";
  final JTextField quickSearch=new JTextField(quickSearchText);
  quickSearch.setForeground(Color.gray);
  quickSearch.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent ke){
      if (ke.getKeyCode() == KeyEvent.VK_ENTER) {
        final String qt=quickSearch.getText();
        quickSearch.setText("");
        String[] path=null;
        if (qt.contains(".")) {
          path=qt.split("\\.");
          String[] path2=new String[path.length];
          for (int i=0; i < path.length; i++) {
            path2[i]=path[i];
            if (i + 2 == path.length) {
              path2[i + 1]="." + path[i + 1];
            }
          }
        }
 else {
          path=new String[]{qt};
        }
        MyTreeNode curNode=treeRoot;
        if (exact.isSelected()) {
          pathLoop:           for (int i=0; i < path.length; i++) {
            final String pathName=path[i];
            final boolean isLast=i == path.length - 1;
            for (int c=0; c < curNode.getChildCount(); c++) {
              final MyTreeNode child=(MyTreeNode)curNode.getChildAt(c);
              System.out.println(pathName + ":" + ((String)child.getUserObject()));
              if (((String)child.getUserObject()).equals(pathName)) {
                curNode=child;
                if (isLast) {
                  final TreePath pathn=new TreePath(curNode.getPath());
                  tree.setSelectionPath(pathn);
                  tree.makeVisible(pathn);
                  tree.scrollPathToVisible(pathn);
                  System.out.println("Found! " + curNode);
                  break pathLoop;
                }
                continue pathLoop;
              }
            }
            System.out.println("Could not find " + pathName);
            break;
          }
        }
 else {
{
            @SuppressWarnings("unchecked") Enumeration<MyTreeNode> enums=curNode.depthFirstEnumeration();
            while (enums != null && enums.hasMoreElements()) {
              MyTreeNode node=enums.nextElement();
              if (node.isLeaf()) {
                if (((String)(node.getUserObject())).toLowerCase().contains(path[path.length - 1].toLowerCase())) {
                  TreeNode pathArray[]=node.getPath();
                  int k=0;
                  StringBuffer fullPath=new StringBuffer();
                  while (pathArray != null && k < pathArray.length) {
                    MyTreeNode n=(MyTreeNode)pathArray[k];
                    String s=(String)(n.getUserObject());
                    fullPath.append(s);
                    if (k++ != pathArray.length - 1) {
                      fullPath.append(".");
                    }
                  }
                  String fullPathString=fullPath.toString();
                  if (fullPathString != null && fullPathString.toLowerCase().contains(qt.toLowerCase())) {
                    System.out.println("Found! " + node);
                    final TreePath pathn=new TreePath(node.getPath());
                    tree.setSelectionPath(pathn.getParentPath());
                    tree.setSelectionPath(pathn);
                    tree.makeVisible(pathn);
                    tree.scrollPathToVisible(pathn);
                  }
                }
              }
            }
          }
        }
      }
    }
  }
);
  quickSearch.addFocusListener(new FocusListener(){
    @Override public void focusGained(    final FocusEvent arg0){
      if (quickSearch.getText().equals(quickSearchText)) {
        quickSearch.setText("");
        quickSearch.setForeground(Color.black);
      }
    }
    @Override public void focusLost(    final FocusEvent arg0){
      if (quickSearch.getText().isEmpty()) {
        quickSearch.setText(quickSearchText);
        quickSearch.setForeground(Color.gray);
      }
    }
  }
);
  JPanel p2=new JPanel();
  p2.setLayout(new BorderLayout());
  p2.add(quickSearch,BorderLayout.NORTH);
  JPanel p3=new JPanel(new BorderLayout());
  p3.add(exact,BorderLayout.WEST);
  JPanel p4=new JPanel(new BorderLayout());
  p4.add(open,BorderLayout.EAST);
  p4.add(close,BorderLayout.WEST);
  p3.add(p4,BorderLayout.EAST);
  p2.add(p3,BorderLayout.SOUTH);
  getContentPane().add(p2,BorderLayout.SOUTH);
  this.setVisible(true);
  new FileDrop(this,this);
}
