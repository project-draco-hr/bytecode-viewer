{
  if (tr.iClass == null) {
    Scope s;
    for (s=tr.getEnclosingBlockStatement(); s instanceof Statement || s instanceof CatchClause; s=s.getEnclosingScope())     ;
    if (s instanceof FunctionDeclarator) {
      FunctionDeclarator function=(FunctionDeclarator)s;
      if (Mod.isStatic(function.modifiers.flags)) {
        this.compileError("No current instance available in static method",tr.getLocation());
      }
    }
    while (!(s instanceof TypeDeclaration)) {
      s=s.getEnclosingScope();
    }
    if (!(s instanceof ClassDeclaration)) {
      this.compileError("Only methods of classes can have a current instance",tr.getLocation());
    }
    tr.iClass=this.resolve((ClassDeclaration)s);
  }
  return tr.iClass;
}
